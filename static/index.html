<!DOCTYPE html>
<html>

<head>
    <title>RussianNouns test</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="favicon.ico">
    <script src="RussianNouns.min.js"></script>
    <style>
body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
	font-size: 1rem;
	font-weight: 400;
	line-height: 1.5;
	color: #212529;
	text-align: left;
}
*, ::before, ::after {
	box-sizing: border-box;
}
.form-control {
	display: inline;
	width: 100%;
	height: calc(1.5em + 0.75rem + 2px);
	padding: 0.375rem 0.75rem;
	font-size: 1rem;
	font-weight: 400;
	line-height: 1.5;
	color: #495057;
    max-width: 33.333333%;
	background-color: #fff;
	background-clip: padding-box;
	border: 1px solid #ced4da;
	border-radius: 0.25rem;
	transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}
.center {
    margin-left: 33.333333%;
    align-items: center;
    width:100%;
    margin-bottom: 5px;
}
    </style>
</head>

<body>

<script>

const rne = new RussianNouns.Engine();
const CASE = {
    "им" : RussianNouns.Case.NOMINATIVE,
    "ро" : RussianNouns.Case.GENITIVE,
    "да" : RussianNouns.Case.DATIVE,
    "ви" : RussianNouns.Case.ACCUSATIVE,
    "тв" : RussianNouns.Case.INSTRUMENTAL,
    "пр" : RussianNouns.Case.PREPOSITIONAL,
    "ме" : RussianNouns.Case.LOCATIVE,
    "и" : RussianNouns.Case.NOMINATIVE,
    "р" : RussianNouns.Case.GENITIVE,
    "д" : RussianNouns.Case.DATIVE,
    "в" : RussianNouns.Case.ACCUSATIVE,
    "т" : RussianNouns.Case.INSTRUMENTAL,
    "п" : RussianNouns.Case.PREPOSITIONAL,
    "м" : RussianNouns.Case.LOCATIVE
}
const GENDER = {
    "жен" : RussianNouns.Gender.FEMININE,
    "муж" : RussianNouns.Gender.MASCULINE,
    "ср": RussianNouns.Gender.NEUTER,
    "общ" : RussianNouns.Gender.COMMON,
    "neuter" : RussianNouns.Gender.NEUTER,
    "male" : RussianNouns.Gender.MASCULINE,
    "female" : RussianNouns.Gender.FEMININE
}

const L = RussianNouns.createLemma;

function findGender(word)
{
    if(["ая", "ия"].indexOf(word.slice(-2)) != -1 || ["а","я"].indexOf(word.slice(-1)) != -1) {
        return RussianNouns.Gender.FEMININE
    }
    if(["ий"].indexOf(word.slice(-2)) != -1 || ["ь","й"].indexOf(word.slice(-1)) != -1) {
        return RussianNouns.Gender.MASCULINE
    }
    if(["о","е"].indexOf(word.slice(-1)) != -1) {
        return RussianNouns.Gender.NEUTER
    }
}

function changed()
{
    console.log("changed")

    //var list = document.getElementsByTagName("L") 
    var list = [document.getElementById("in")]
    //console.log(list)
    
    var undecided = document.getElementById("undecided").value.split(" ")
    //console.log(undecided)

    var css = document.getElementById("css")
    //console.log(css)

    var output = document.getElementById("output")
    //console.log(output)

    for(var i = 0; i < list.length; i++) {
        element = list[i]
        //console.log(element)
        var words = element.value.split(" ")
        for(j in words) {
            var word = words[j]
            if(undecided.find(el => el.toLowerCase() === word.toLowerCase()))
            {
                console.log("undecided - continue")
                continue
            }
            if(word.trim() === "")
            {
                console.log("space - continue")
                continue
            }
            if(word[0] === "(" || word[0] === "[" || word[0] === "{")
            {
                console.log("([{ break")
                break
            }
            css_list = css.value.split(" ")
            var Case = null
            var Gender = null
            var Plural = false
            var Indeclinable = false
            var Auto = false
            for(k in css_list)
            {
                css_class = css_list[k]
                if(css_class.trim() === "")
                    continue
                css_class = css_class.toLowerCase()
                if(css_class in CASE)
                {
                    Case = CASE[css_class]
                    continue
                }
                if(css_class in GENDER)
                {
                    Gender = GENDER[css_class]
                    continue
                }
                if(css_class == "мн" || css_class == "plural")
                {
                    Plural = true
                    continue
                }
                console.log(`undefined class: "${css_class}"`)
            }
            console.log(`word: ${word}`)
            console.log(`Case: ${Case}`)
            if(!Case)
            {
                console.log("Error: Не указан падеж")
                return
            }
            if(Gender)
            {
                console.log(`Gender: ${Gender}`)
            }
            if(!Gender) // Попытаться определить род по окончанию
            {
                Gender = findGender(word)
                if(!Gender)
                {
                    Gender = RussianNouns.Gender.COMMON
                }
                console.log(`Gender: undefined -> ${Gender}`)
            }
            console.log(`Plural: ${Plural}`)
           
            var lemma = L({text: word, gender: Gender, pluraleTantum: Plural, indeclinable: Indeclinable})
            words[j] = rne.decline(lemma, Case)[0]
        }
        output.innerText = words.join(" ")
    }
}
</script>

    <div class="center">
        <input class="form-control" id="undecided" type="text" onkeyup="changed()" placeholder="Список несклоняемых слов, аббревиатур">
    </div>
    <div class="center">
        <input class="form-control" id="css" type="text" onkeyup="changed()" placeholder="L class=" required="required" style="width:105px">
        <input class="form-control" id="in" type="text" onkeyup="changed()" placeholder="слова" required="required" style="width:80%" autofocus>
    </div>
        <div class="center" id="output"></div>
    </div>
</body>

</html>