<!DOCTYPE html>
<html>

<head>
    <title>RussianNouns test</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="favicon.ico">
    <script src="RussianNouns.min.js"></script>
    <style>
body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
	font-size: 1rem;
	font-weight: 400;
	line-height: 1.5;
	color: #212529;
	text-align: left;
}
*, ::before, ::after {
	box-sizing: border-box;
}
.form-control {
	display: inline;
	width: 100%;
	height: calc(1.5em + 0.75rem + 2px);
	padding: 0.375rem 0.75rem;
	font-size: 1rem;
	font-weight: 400;
	line-height: 1.5;
	color: #495057;
    max-width: 33.333333%;
	background-color: #fff;
	background-clip: padding-box;
	border: 1px solid #ced4da;
	border-radius: 0.25rem;
	transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}
.center {
    margin-left: 33.333333%;
    align-items: center;
    width:100%;
    margin-bottom: 5px;
}
    </style>
</head>

<body>

<script>

const rne = new RussianNouns.Engine();
const CASE = {
    "им" : RussianNouns.Case.NOMINATIVE,
    "ро" : RussianNouns.Case.GENITIVE,
    "да" : RussianNouns.Case.DATIVE,
    "ви" : RussianNouns.Case.ACCUSATIVE,
    "тв" : RussianNouns.Case.INSTRUMENTAL,
    "пр" : RussianNouns.Case.PREPOSITIONAL,
    "ме" : RussianNouns.Case.LOCATIVE,
    "и" : RussianNouns.Case.NOMINATIVE,
    "р" : RussianNouns.Case.GENITIVE,
    "д" : RussianNouns.Case.DATIVE,
    "в" : RussianNouns.Case.ACCUSATIVE,
    "т" : RussianNouns.Case.INSTRUMENTAL,
    "п" : RussianNouns.Case.PREPOSITIONAL,
    "м" : RussianNouns.Case.LOCATIVE
}
const GENDER = {
    "жен" : RussianNouns.Gender.FEMININE,
    "муж" : RussianNouns.Gender.MASCULINE,
    "ср": RussianNouns.Gender.NEUTER,
    "общ" : RussianNouns.Gender.COMMON,
    "neuter" : RussianNouns.Gender.NEUTER,
    "male" : RussianNouns.Gender.MASCULINE,
    "female" : RussianNouns.Gender.FEMININE
}

const L = RussianNouns.createLemma;

function findGender(word)
{
    if(["ая", "ия"].indexOf(word.slice(-2)) != -1 || ["а","я"].indexOf(word.slice(-1)) != -1 || ["ень","ать"].indexOf(word.slice(-3)) != -1) {
        return RussianNouns.Gender.FEMININE
    }
    if(["ий"].indexOf(word.slice(-2)) != -1 || ["ь","й"].indexOf(word.slice(-1)) != -1) {
        return RussianNouns.Gender.MASCULINE
    }
    if(["о","е"].indexOf(word.slice(-1)) != -1) {
        return RussianNouns.Gender.NEUTER
    }
}

function changed()
{
    //console.log("changed")

    //var list = document.getElementsByTagName("L") 
    var list = [document.getElementById("in")]
    //console.log(list)
    
    var undecided = document.getElementById("undecided").value.split(" ")
    //console.log(undecided)
    const prepositions = ["а-ля","без","безо","благодаря","близ","близко","в",
    "вблизи","ввиду","вглубь","вдогон","вдоль","взамен","включая",
    "вкруг","вместо","вне","внизу","внутри","внутрь","во","вовнутрь","возле","вокруг",
    "вопреки","вослед","впереди","вплоть","впредь","вразрез","вроде","вслед","вследствие",
    "встречу","выключая","для","для-ради","до","за","замест","заместо","из","из-за","из-под","из-подо","изнутри",
    "изо","исключая","исходя","к","касаемо","касательно","ко","кончая","кроме","кругом","лицом","меж","между","мимо",
    "на","наверху","навроде","навстречу","над","надо","назад","назади","назло","накануне","наместо","наперекор",
    "наперерез","наперехват","наподобие","наподобье","напротив","наряду","насупротив","насчёт","начиная","считая",
    "невзирая","недалеко","независимо","несмотря","ниже","о","об","обо","обок","обочь","около",
    "окрест","окроме","окромя","округ","опосля","опричь","от","относительно","ото","перед","передо",
    "по","по-за","по-над","по-под","поблизости","повдоль","поверх","под","подле","подо","подобно",
    "позади","позадь","позднее","помимо","поперёд","поперёк","порядка","посверху","посереди","посередине","посерёдке","посередь",
    "после","посреди","посредине","посредством","пред","предо","преж","прежде","при","применительно","про",
    "промеж","промежду","против","противно","противу","путём","ради","рядом","с","сверх"]

    var css = document.getElementById("css")
    //console.log(css)

    var output = document.getElementById("output")
    var output2 = document.getElementById("output2")
    var table = []
    
    iii = 0
    for(ii in RussianNouns.Case)
    {
        table[iii] = `${RussianNouns.Case[ii][0].toUpperCase()}: `
        iii++
    }
    output.innerText = ""
    output2.innerText = ""
    //console.log(output)
    for(var i = 0; i < list.length; i++) {
        element = list[i]
        //console.log(element)
        var words = element.value.split(" ")
        for(var j = 0; j < words.length; j++) {
            var word = words[j]
            if(undecided.find(el => el.toLowerCase() === word.toLowerCase()))
            {
                console.log(`CONTINUE: ${word} is undecided`)
                continue
            }
            if(prepositions.find(el => el.toLowerCase() === word.toLowerCase()))
            {
                console.log(`EXIT: ${word} is preposition`)
                break
            }
            if(word.trim() === "")
            {
                console.log(`CONTINUE: spaces`)
                continue
            }
            if(word[0] === "(" || word[0] === "[" || word[0] === "{")
            {
                console.log(`EXIT: "([{" `)
                break
            }
            const regex = /[^\u0430-\u044f]$/g;
            if(word.toLowerCase().trim().search(regex) != -1)
            {
                console.log(`EXIT: "${word} - not cyrillic end" `)
                break
            }
            css_list = css.value.split(" ")
            var Case = null
            var Gender = null
            var is_undefined_gender = false
            var Plural = false
            var Indeclinable = false
            var Surname = false
            var isnoun = false
            for(k in css_list)
            {
                css_class = css_list[k]
                if(css_class.trim() === "")
                    continue
                css_class = css_class.toLowerCase()
                if(css_class in CASE)
                {
                    Case = CASE[css_class]
                    continue
                }
                if(css_class in GENDER)
                {
                    Gender = GENDER[css_class]
                    continue
                }
                if(css_class == "мн" || css_class == "plural")
                {
                    Plural = true
                    continue
                }
                console.log(`undefined class: "${css_class}"`)
            }
            if(!Case)
            {
                console.log("Error: Не указан падеж")
                return
            }
            if(!Gender) // Попытаться определить род по окончанию
            {
                is_undefined_gender = true
                Gender = findGender(word) || RussianNouns.Gender.COMMON
            }
            if(["ая","яя","ое","ее","ие","ые","ой","ий","ый"].indexOf(word.slice(-2)) == -1) // если не прилагательное, то считать, что существительное, да
            {
                isnoun = true
            }
            // Окончание прилагательных на ой
            if(["хой","жой","лой", "мой", "ной"].indexOf(word.slice(-3).toLowerCase()) != -1){
                Surname = true
            }

            // Числительные
            var lemma = L({text: word, gender: Gender, pluraleTantum: Plural, indeclinable: Indeclinable, surname: Surname})
            
            words[j] = rne.decline(lemma, Case)[0]
            output2.innerText += `\nword: ${word} --> ${words[j]} (${Case})\n`
            output2.innerText += is_undefined_gender ? `Gender: undefined -> ${Gender}\n` : `Gender: ${Gender}\n`
            output2.innerText += `Plural: ${Plural}\n`
            output2.innerText += `surname: ${Surname}\n`
            iii = 0
            for(ii in RussianNouns.Case)
            {
                table[iii] += `${rne.decline(L({text: word, gender: Gender, pluraleTantum: Plural, indeclinable: Indeclinable, surname: Surname}), RussianNouns.Case[ii])[0]} `
                iii++
            }
            output2.innerText += `\n-----------------------------------------\n`
            if(isnoun)
            {
                console.log("EXIT: связь не согласование")
                break
            }
        }
        output.innerText += words.join(" ") + "\n\n" + table.join("\n")
    }
}
</script>

    <div class="center">
        <input class="form-control" id="undecided" type="text" onkeyup="changed()" placeholder="Список несклоняемых слов, аббревиатур">
    </div>
    <div class="center">
        <input class="form-control" id="css" type="text" onkeyup="changed()" placeholder="L class=" required="required" style="width:105px">
        <input class="form-control" id="in" type="text" onkeyup="changed()" placeholder="слова" required="required" style="width:80%" autofocus>
    </div>
        <div class="center" id="output"></div>
        <div class="center" id="output2"></div>
    </div>
</body>

</html>